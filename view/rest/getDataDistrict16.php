<?php
    $title = 'Webservice1';
    $cssFile = 'style-webservice1.css';
    $jsFile = '';
?>

<?php ob_start(); ?>

<button type="submit" class="bubbly-button" id="district-button-1" onclick=<?php $url = 'https://opendata.paris.fr/api/records/1.0/search/?dataset=sites-disposant-du-service-paris-wi-fi&q=&rows=300&facet=cp&facet=nom_site&facet=arc_adresse&facet=geo_point_2d&facet=etat2&q=cp%3D75001'?>>Spots wifi du 1er arrondissement</button>

<button type="submit" class="bubbly-button" id="district-button-2" onclick=<?php $url = 'https://opendata.paris.fr/api/records/1.0/search/?dataset=sites-disposant-du-service-paris-wi-fi&q=&rows=300&facet=cp&facet=nom_site&facet=arc_adresse&facet=geo_point_2d&facet=etat2&q=cp%3D75002'?>>Spots wifi du 2ème arrondissement</button>

<button type="submit" class="bubbly-button" id="district-button-3" onclick=<?php $url = 'https://opendata.paris.fr/api/records/1.0/search/?dataset=sites-disposant-du-service-paris-wi-fi&q=&rows=300&facet=cp&facet=nom_site&facet=arc_adresse&facet=geo_point_2d&facet=etat2&q=cp%3D75003'?>>Spots wifi du 3ème arrondissement</button>

<button type="submit" class="bubbly-button" id="district-button-4" onclick=<?php $url = 'https://opendata.paris.fr/api/records/1.0/search/?dataset=sites-disposant-du-service-paris-wi-fi&q=&rows=300&facet=cp&facet=nom_site&facet=arc_adresse&facet=geo_point_2d&facet=etat2&q=cp%3D75004'?>>Spots wifi du 4ème arrondissement</button>

<button type="submit" class="bubbly-button" id="district-button-5" onclick=<?php $url = 'https://opendata.paris.fr/api/records/1.0/search/?dataset=sites-disposant-du-service-paris-wi-fi&q=&rows=300&facet=cp&facet=nom_site&facet=arc_adresse&facet=geo_point_2d&facet=etat2&q=cp%3D75005'?>>Spots wifi du 5ème arrondissement</button>

<button type="submit" class="bubbly-button" id="district-button-6" onclick=<?php $url = 'https://opendata.paris.fr/api/records/1.0/search/?dataset=sites-disposant-du-service-paris-wi-fi&q=&rows=300&facet=cp&facet=nom_site&facet=arc_adresse&facet=geo_point_2d&facet=etat2&q=cp%3D75006'?>>Spots wifi du 6ème arrondissement</button>

<button type="submit" class="bubbly-button" id="district-button-7" onclick=<?php $url = 'https://opendata.paris.fr/api/records/1.0/search/?dataset=sites-disposant-du-service-paris-wi-fi&q=&rows=300&facet=cp&facet=nom_site&facet=arc_adresse&facet=geo_point_2d&facet=etat2&q=cp%3D75007'?>>Spots wifi du 7ème arrondissement</button>

<button type="submit" class="bubbly-button" id="district-button-8" onclick=<?php $url = 'https://opendata.paris.fr/api/records/1.0/search/?dataset=sites-disposant-du-service-paris-wi-fi&q=&rows=300&facet=cp&facet=nom_site&facet=arc_adresse&facet=geo_point_2d&facet=etat2&q=cp%3D75008'?>>Spots wifi du 8ème arrondissement</button>

<button type="submit" class="bubbly-button" id="district-button-9" onclick=<?php $url = 'https://opendata.paris.fr/api/records/1.0/search/?dataset=sites-disposant-du-service-paris-wi-fi&q=&rows=300&facet=cp&facet=nom_site&facet=arc_adresse&facet=geo_point_2d&facet=etat2&q=cp%3D75009'?>>Spots wifi du 9ème arrondissement</button>

<button type="submit" class="bubbly-button" id="district-button-10" onclick=<?php $url = 'https://opendata.paris.fr/api/records/1.0/search/?dataset=sites-disposant-du-service-paris-wi-fi&q=&rows=300&facet=cp&facet=nom_site&facet=arc_adresse&facet=geo_point_2d&facet=etat2&q=cp%3D75010'?>>Spots wifi du 10ème arrondissement</button>

<button type="submit" class="bubbly-button" id="district-button-11" onclick=<?php $url = 'https://opendata.paris.fr/api/records/1.0/search/?dataset=sites-disposant-du-service-paris-wi-fi&q=&rows=300&facet=cp&facet=nom_site&facet=arc_adresse&facet=geo_point_2d&facet=etat2&q=cp%3D75011'?>>Spots wifi du 11ème arrondissement</button>

<button type="submit" class="bubbly-button" id="district-button-12" onclick=<?php $url = 'https://opendata.paris.fr/api/records/1.0/search/?dataset=sites-disposant-du-service-paris-wi-fi&q=&rows=300&facet=cp&facet=nom_site&facet=arc_adresse&facet=geo_point_2d&facet=etat2&q=cp%3D75012'?>>Spots wifi du 12ème arrondissement</button>

<button type="submit" class="bubbly-button" id="district-button-13" onclick=<?php $url = 'https://opendata.paris.fr/api/records/1.0/search/?dataset=sites-disposant-du-service-paris-wi-fi&q=&rows=300&facet=cp&facet=nom_site&facet=arc_adresse&facet=geo_point_2d&facet=etat2&q=cp%3D75013'?>>Spots wifi du 13ème arrondissement</button>

<button type="submit" class="bubbly-button" id="district-button-14" onclick=<?php $url = 'https://opendata.paris.fr/api/records/1.0/search/?dataset=sites-disposant-du-service-paris-wi-fi&q=&rows=300&facet=cp&facet=nom_site&facet=arc_adresse&facet=geo_point_2d&facet=etat2&q=cp%3D75014'?>>Spots wifi du 14ème arrondissement</button>

<button type="submit" class="bubbly-button" id="district-button-15" onclick=<?php $url = 'https://opendata.paris.fr/api/records/1.0/search/?dataset=sites-disposant-du-service-paris-wi-fi&q=&rows=300&facet=cp&facet=nom_site&facet=arc_adresse&facet=geo_point_2d&facet=etat2&q=cp%3D75015'?>>Spots wifi du 15ème arrondissement</button>

<button type="submit" class="bubbly-button" id="district-button-16" onclick=<?php $url = 'https://opendata.paris.fr/api/records/1.0/search/?dataset=sites-disposant-du-service-paris-wi-fi&q=&rows=300&facet=cp&facet=nom_site&facet=arc_adresse&facet=geo_point_2d&facet=etat2&q=cp%3D75016'?>>Spots wifi du 16ème arrondissement</button>

<button type="submit" class="bubbly-button" id="district-button-17" onclick=<?php $url = 'https://opendata.paris.fr/api/records/1.0/search/?dataset=sites-disposant-du-service-paris-wi-fi&q=&rows=300&facet=cp&facet=nom_site&facet=arc_adresse&facet=geo_point_2d&facet=etat2&q=cp%3D75017'?>>Spots wifi du 17ème arrondissement</button>

<button type="submit" class="bubbly-button" id="district-button-18" onclick=<?php $url = 'https://opendata.paris.fr/api/records/1.0/search/?dataset=sites-disposant-du-service-paris-wi-fi&q=&rows=300&facet=cp&facet=nom_site&facet=arc_adresse&facet=geo_point_2d&facet=etat2&q=cp%3D75018'?>>Spots wifi du 18ème arrondissement</button>

<button type="submit" class="bubbly-button" id="district-button-19" onclick=<?php $url = 'https://opendata.paris.fr/api/records/1.0/search/?dataset=sites-disposant-du-service-paris-wi-fi&q=&rows=300&facet=cp&facet=nom_site&facet=arc_adresse&facet=geo_point_2d&facet=etat2&q=cp%3D75019'?>>Spots wifi du 19ème arrondissement</button>

<button type="submit" class="bubbly-button" id="district-button-20" onclick=<?php $url = 'https://opendata.paris.fr/api/records/1.0/search/?dataset=sites-disposant-du-service-paris-wi-fi&q=&rows=300&facet=cp&facet=nom_site&facet=arc_adresse&facet=geo_point_2d&facet=etat2&q=cp%3D75020'?>>Spots wifi du 20ème arrondissement</button>

<button type="submit" class="bubbly-button" id="paris-button" onclick=<?php $url = 'https://opendata.paris.fr/api/records/1.0/search/?dataset=sites-disposant-du-service-paris-wi-fi&q=&rows=300&facet=cp&facet=nom_site&facet=arc_adresse&facet=geo_point_2d&facet=etat2' ?>>Spots wifi de Paris</button>

<?php $content = ob_get_clean(); ?>

<?php require('template.php'); ?>

<?php

// Headers requis
header("Access-Control-Allow-Origin: *");
header("Content-Type: application/json; charset=UTF-8");
header("Access-Control-Allow-Methods: GET");
header("Access-Control-Max-Age: 3600");
header("Access-Control-Allow-Headers: Content-Type, Access-Control-Allow-Headers, Authorization, X-Requested-With");

// On vérifie que la méthode utilisée est correcte
if ($_SERVER['REQUEST_METHOD'] == 'GET') {

    // On veut par exmemple obtenir les spots dans le 16 eme arrondissement
    // On inclut les fichiers de configuration et d'accès aux données
    $parisData = 'https://opendata.paris.fr/api/records/1.0/search/?dataset=sites-disposant-du-service-paris-wi-fi&q=&rows=300&facet=cp&facet=nom_site&facet=arc_adresse&facet=geo_point_2d&facet=etat2&q=cp%3D75016';
    $curlData = curl_init($parisData);

    // On instancie la base de données

    curl_setopt_array($curlData,[
        CURLOPT_SSL_VERIFYPEER => __DIR__.DIRECTORY_SEPARATOR.'C:\wamp64\www\1\WifiSpotsParis\certifParisData',
        CURLOPT_RETURNTRANSFER =>true,
        CURLOPT_TIMEOUT => 1
    ]);


    //Instanciation des spots
    $data= curl_exec($curlData);
    $data = json_decode($data,true);
    $spots = [];
    foreach($data['records'] as $record){
        //Récupération du spot
        $row = [
            "cp" => $record['fields']['cp'],
            "nom_site" => $record['fields']['nom_site'],
            "arc_adresses" => $record['fields']['arc_adresse'],
            "etat2" => $record['fields']['etat2']
        ];
        $spots['Spots WiFi'][] = $row;
    }
    // On envoie le code réponse 200 OK
    http_response_code(200);
    // On encode en json et on envoie
    echo json_encode($spots);




    //Close curl
    curl_close($curlData);

    /*
    // Instanciations des utilisateur à faire
    //TODO
    $produit = new Produits($db);

    $donnees = json_decode(file_get_contents("php://input"));

    if (!empty($donnees->id)) {
        $produit->id = $donnees->id;

        // On récupère le produit
        $produit->lireUn();

        // On vérifie si le produit existe
        if ($produit->nom != null) {

            $prod = [
                "id" => $produit->id,
                "nom" => $produit->nom,
                "description" => $produit->description,
                "prix" => $produit->prix,
                "categories_id" => $produit->categories_id,
                "categories_nom" => $produit->categories_nom
            ];
            // On envoie le code réponse 200 OK
            http_response_code(200);

            // On encode en json et on envoie
            echo json_encode($prod);
        } else {
            // 404 Not found
            http_response_code(404);

            echo json_encode(array("message" => "Le produit n'existe pas."));
        }


    }*/
} else {
    // On gère l'erreur
    http_response_code(405);
    echo json_encode(["message" => "La méthode n'est pas autorisée"]);
}